---
layout: none
permalink: /well-kept-wallet/debt-snowball
published: true
sitemap: false
---
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

</head>
<body style="background-color: #f5f5f5">
<style>
  :root{
    --calculator-primary-color: #2bb34b;
    --calculator-line-color: #333;
    --calculator-heading-font: raleway, sans-serif;
    --calculator-paragraph-font: nunito, sans-serif;
  }
  .debt-snowball-calculator {
    font-size: 16px;
    font-family: var(--calculator-paragraph-font);
    width: calc(100% - 1rem);
    max-width: 800px;
    margin: 2rem auto;

    border-radius: 0.5rem;
    background-color: white;
    overflow: hidden;
  }
</style>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.3/Chart.bundle.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/chartkick/2.3.0/chartkick.min.js"></script>
<script async type="text/javascript">
  const lenderCell = (updateResults) => {
    const cell = document.createElement('td');
    const input = document.createElement('input');
    input.setAttribute('type', 'text');
    input.setAttribute('name', 'lender');
    input.addEventListener('blur', () => {
      if (input.value === '') {
        input.classList.add('invalid')
      } else {
        input.classList.remove('invalid')
      }
      updateResults();
    });
    cell.classList.add('calculator-debt-line-lender');
    cell.appendChild(input);
    return cell;
  }
  const amountOwedCell = (updateResults) => {
    const cell = document.createElement('td');
    const input = document.createElement('input');
    input.setAttribute('type', 'number');
    input.setAttribute('name', 'amount-owed');
    input.addEventListener('blur', () => {
      if (input.value === '') {
        input.classList.add('invalid')
      } else {
        input.classList.remove('invalid')
      }
      updateResults();
    });
    cell.classList.add('calculator-debt-line-amount-owed');
    cell.appendChild(input);
    return cell;
  }
  const interestRateCell = (updateResults) => {
    const cell = document.createElement('td');
    const input = document.createElement('input');
    input.setAttribute('type', 'number');
    input.setAttribute('name', 'interest-rate');
    input.addEventListener('blur', () => {
      if (input.value === '') {
        input.classList.add('invalid')
      } else {
        input.classList.remove('invalid')
      }
      updateResults();
    });
    cell.classList.add('calculator-debt-line-interest-rate');
    cell.appendChild(input);
    return cell;
  }
  const minimumPaymentCell = (updateResults) => {
    const cell = document.createElement('td');
    const input = document.createElement('input');
    input.setAttribute('type', 'number');
    input.setAttribute('name', 'minimum-payment');
    input.addEventListener('blur', () => {
      if (input.value === '') {
        input.classList.add('invalid')
      } else {
        input.classList.remove('invalid')
      }
      updateResults();
    });
    cell.classList.add('calculator-debt-line-minimum-payment');
    cell.appendChild(input);
    return cell;
  }
  const deleteButton = (updateResults) => {
    const cell = document.createElement('td');
    const button = document.createElement('button');
    button.appendChild(document.createTextNode('X'));
    button.classList.add('calculator-debt-line-delete-button');
    button.addEventListener('click', () => {
      const row = cell.parentNode;
      const tbody = row.parentNode;
      tbody.removeChild(row);
      updateResults();
    });
    cell.appendChild(button);
    return cell;
  }
  const addDebtLine = (debtLineTable, updateResults) => {
    const lineHolder = debtLineTable.querySelector('tbody');
    const newLine = document.createElement('tr');

    const lendCell = lenderCell(updateResults);

    newLine.appendChild(lendCell);
    newLine.appendChild(amountOwedCell(updateResults));
    newLine.appendChild(interestRateCell(updateResults));
    newLine.appendChild(minimumPaymentCell(updateResults));
    newLine.appendChild(deleteButton(updateResults));

    lineHolder.appendChild(newLine);

    lendCell.querySelector('input').focus();
  }
  const parseDebtLine = (debtLine) => {
    const lender = debtLine.querySelector('input[name=lender]').value || '';
    const startingBalance = parseFloat(debtLine.querySelector('input[name=amount-owed]').value) || 0;
    const amountOwed = startingBalance
    const interestRate = parseFloat(debtLine.querySelector('input[name=interest-rate]').value) / 100.0 || 0;
    const minimumPayment = parseFloat(debtLine.querySelector('input[name=minimum-payment]').value) || 0;
    const payments = [];
    const interest = [];
    const balance = [];
    const snowball = [];
    if (lender && startingBalance && interestRate && minimumPayment) {
      return { lender, amountOwed, interestRate, minimumPayment, payments, interest, snowball, balance, startingBalance };
    } else {
      return null;
    }
  }
  const summarizeDebts = (debts, paidOffMonth) => {
    debts.forEach((debt) => {
      debt.totalPaid = debt.payments.reduce((total, payment) => total + payment, 0);
      debt.totalInterest = debt.interest.reduce((total, interest) => total + interest, 0);
      debt.paidOffMonth = debt.payments.findIndex((payment) => payment === 0) + 1 || debt.payments.length;
      debt.chartData = debt.balance.map((balance, index) => [index + 1, balance])
      debt.chartData.unshift([0, debt.startingBalance])
    })

    const tableData = []

    for (let i = 0; i < paidOffMonth; i += 1) {
      let balances = {}
      let payments = {}
      debts.forEach((debt) => {
        balances[debt.lender] = debt.balance[i]
        payments[debt.lender] = debt.payments[i]
      })
      tableData.push({
        month: i + 1,
        totalRemaining: debts.reduce((total, debt) => total + debt.balance[i], 0),
        totalPayments: debts.reduce((total, debt) => total + debt.payments[i], 0),
        totalInterest: debts.reduce((total, debt) => total + debt.interest[i], 0),
        snowballSize: debts.reduce((total, debt) => total + debt.snowball[i], 0),
        balances,
        payments
      })
    }
    return tableData;
  }
  const runScenario = (rawDebts, rawSurplus) => {
    const debts = JSON.parse(JSON.stringify(rawDebts))
    let paidOff = false;
    const debtPayment = debts.reduce((total, element) => total + element.minimumPayment, rawSurplus)

    for (let i = 0; i < 1200 && !paidOff; i++) {
      let paymentRemaining = debtPayment;
      /* Accrue interest and make minimum payment */
      debts.forEach((debt) => {
        let interestAccrued = debt.amountOwed * (debt.interestRate / 12.0)
        debt.amountOwed = debt.amountOwed + interestAccrued
        debt.interest[i] = interestAccrued;

        if (debt.amountOwed >= debt.minimumPayment) {
          debt.payments[i] = debt.minimumPayment;
          debt.amountOwed -= debt.minimumPayment;
          paymentRemaining -= debt.minimumPayment;
          debt.balance[i] = Math.round(debt.amountOwed, 2);
        } else {
          debt.payments[i] = debt.amountOwed
          paymentRemaining -= debt.amountOwed
          debt.amountOwed = 0;
          debt.balance[i] = 0;
        }
      });
      /* Apply surplus starting with smallest balance and working through */
      debts.forEach((debt) => {
        let payment = Math.min(debt.amountOwed, paymentRemaining);
        debt.amountOwed -= payment;
        paymentRemaining -= payment;
        debt.payments[i] = (debt.payments[i] || 0) + payment;
        debt.balance[i] = Math.round(debt.amountOwed, 2);
        debt.snowball[i] = Math.max(debt.payments[i] - debt.minimumPayment, 0)
      });

      const debtRemaining = debts.reduce((total, element) => total + element.amountOwed, 0)
      paidOff = (debtRemaining === 0) ? i + 1 : false;
    }

    const tableData = summarizeDebts(debts, paidOff);

    const scenario = {
      debts,
      paidOff,
      tableData
    }

    return scenario;
  }
  const buildResultTable = (debts, data) => {
    const table = document.createElement('table');
    const heading = document.createElement('thead');
    const headingRow = document.createElement('tr');

    let headingCol = document.createElement('th');
    headingCol.appendChild(document.createTextNode('Month'))
    headingRow.appendChild(headingCol);
    debts.forEach((debt) => {
      headingCol = document.createElement('th');
      headingCol.appendChild(document.createTextNode(`${debt.lender} Payment`))
      headingRow.appendChild(headingCol);
    })
    headingCol = document.createElement('th');
    headingCol.appendChild(document.createTextNode('Snowball Size'))
    headingRow.appendChild(headingCol);
    headingCol = document.createElement('th');
    headingCol.appendChild(document.createTextNode('Debt Remaining'))
    headingRow.appendChild(headingCol);

    heading.appendChild(headingRow);
    table.appendChild(heading);

    const tableBody = document.createElement('tbody');

    data.forEach((row) => {
      tableRow = document.createElement('tr');
      let dataCol = document.createElement('td');
      dataCol.appendChild(document.createTextNode(row.month))
      tableRow.appendChild(dataCol);
      debts.forEach((debt) => {
        dataCol = document.createElement('td');
        dataCol.appendChild(document.createTextNode(toCurrency(row.payments[debt.lender])))
        tableRow.appendChild(dataCol);
      })
      dataCol = document.createElement('td');
      dataCol.appendChild(document.createTextNode(toCurrency(row.snowballSize)))
      tableRow.appendChild(dataCol);
      dataCol = document.createElement('td');
      dataCol.appendChild(document.createTextNode(toCurrency(row.totalRemaining)))
      tableRow.appendChild(dataCol);

      tableBody.appendChild(tableRow);
    });
    table.appendChild(tableBody);

    return table;
  }
  const summaryTable = (debts) => {
    const table = document.createElement('table');
    const heading = document.createElement('thead');
    const headingRow = document.createElement('tr');
    const headingCol1 = document.createElement('th');
    headingCol1.appendChild(document.createTextNode('Order'))
    const headingCol2 = document.createElement('th');
    headingCol2.appendChild(document.createTextNode('Lender'))
    const headingCol3 = document.createElement('th');
    headingCol3.appendChild(document.createTextNode('Total Payments'))
    const headingCol4 = document.createElement('th');
    headingCol4.appendChild(document.createTextNode('Total Interest'))
    const headingCol5 = document.createElement('th');
    headingCol5.appendChild(document.createTextNode('Payoff Date'))
    headingRow.appendChild(headingCol1);
    headingRow.appendChild(headingCol2);
    headingRow.appendChild(headingCol3);
    headingRow.appendChild(headingCol4);
    headingRow.appendChild(headingCol5);
    heading.appendChild(headingRow);
    table.appendChild(heading);

    const body = document.createElement('tbody');

    debts.forEach((debt, index) => {
      const row = document.createElement('tr');
      const order = document.createElement('td');
      order.appendChild(document.createTextNode(index + 1));
      const lender = document.createElement('td');
      lender.appendChild(document.createTextNode(debt.lender))
      const totalPayments = document.createElement('td');
      totalPayments.appendChild(document.createTextNode(toCurrency(debt.totalPaid)));
      const totalInterest = document.createElement('td');
      totalInterest.appendChild(document.createTextNode(toCurrency(debt.totalInterest)));
      const payoffDate = document.createElement('td');
      payoffDate.appendChild(document.createTextNode(`in ${toYearsAndMonths(debt.paidOffMonth)}`));
      row.appendChild(order);
      row.appendChild(lender);
      row.appendChild(totalPayments);
      row.appendChild(totalInterest);
      row.appendChild(payoffDate);
      body.appendChild(row);
    });
    table.appendChild(body);
    return table;
  }
  const chartData = (debts) => {
    return debts.map((debt) => {
      return {
        name: debt.lender,
        data: debt.chartData,
      }
    });
  }
  const toYearsAndMonths = (rawMonths) => {
    const years = Math.floor(rawMonths / 12);
    const months = rawMonths - years * 12;

    const monthString = (months === 1) ? "1 month" : `${months} months`;

    if (years === 0) { return monthString }

    const yearString = (years === 1) ? "1 year" : `${years} years`;

    return `${yearString} ${monthString}`;
  }
  const toCurrency = (value, digits = 2, symbol = '$') => {
    if (value === 0) {
      return "-";
    }
    return symbol + value.toLocaleString(undefined, { minimumFractionDigits: digits, maximumFractionDigits: digits});
  }
  document.addEventListener('DOMContentLoaded', () => {
    console.log("Calculator js running");

    console.log("Calculator helper functions loaded");

    const calculators = document.querySelectorAll('.debt-snowball-calculator');
    calculators.forEach((calculator) => {
      if (calculator) {

        console.log("Calculator found");

        const inputs = calculator.querySelectorAll('input');
        const selects = calculator.querySelectorAll('select');
        const buttons = calculator.querySelectorAll('button');

        const surplusInput = calculator.querySelector('input[name=surplus-payment]');

        const resultSummary = calculator.querySelector('.calculator-result-summary');
        const resultTable = calculator.querySelector('.calculator-result-table');

        const updateResults = () => {
          const surplus = parseFloat(surplusInput.value) || 0;

          const debtLines = calculator.querySelectorAll('table.calculator-debt-lines tbody tr');
          const debts = Array.from(debtLines)
                             .map((debtLine) => parseDebtLine(debtLine))
                             .filter((debt) => { return debt })
                             .sort((debtOne, debtTwo) => debtOne.amountOwed - debtTwo.amountOwed);

          if (debts.length === 0) {
            return;
          }

          const summary = runScenario(debts, surplus)
          if (summary.paidOff) {
            const payoffTimeline = toYearsAndMonths(summary.paidOff)
            resultSummary.innerHTML = `You're on track for debt freedom in ${payoffTimeline}`;
            resultSummary.appendChild(summaryTable(summary.debts));
            resultTable.innerHTML = '';
            resultTable.appendChild(buildResultTable(summary.debts, summary.tableData))
            try {
              new Chartkick.AreaChart(
                "calculator-result-chart",
                chartData(summary.debts),
                {
                  stacked: true,
                  round: 2,
                  zeros: true,
                  prefix: '$',
                  points: false,
                }
              );
            } catch(error) {
              console.log(summary.debts)
            }
          } else {
            resultSummary.innerHTML = 'Your debt payoff is more than 100 years out... try increasing your "surplus" payment'
          }
        }

        const addRowButton = calculator.querySelector('.calculator-debt-lines-button--add');
        const debtLineTable = calculator.querySelector('table.calculator-debt-lines')

        surplusInput.addEventListener('blur', updateResults)
        addRowButton.addEventListener('click', () => addDebtLine(debtLineTable, updateResults));

        addDebtLine(debtLineTable, updateResults);
        updateResults();
      }
    });
  });
</script>

<div class="debt-snowball-calculator">
  <div class="calculator-header">
    <div class="calculator-title">Debt Snowball Calculator</div>
  </div>
  <div class="calculator-body">
    <div class="calculator-inputs">
      <table class="calculator-debt-lines">
        <thead>
          <tr>
            <th>Lender</th>
            <th>Amount Owed</th>
            <th>Interest Rate</th>
            <th>Minimum Payment</th>
            <th></th>
          </tr>
        </thead>
        <tbody>
        </tbody>
      </table>
      <div class="calculator-debt-lines-buttons">
        <button class="calculator-debt-lines-button calculator-debt-lines-button--add">+ Add Row</button>
      </div>
      <div class="calculator-surplus-payment">
        <label for="surplus-payment">Surplus Payment</label>
        <input name="surplus-payment" type="number"></input>
      </div>
    </div>
    <div class="calculator-result-summary">

    </div>
    <div id="calculator-result-chart" style="width:80%; height: 400px;"></div>
    <div class="calculator-result-table"></div>
  </div>
</div>

</body>
</html>
